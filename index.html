<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>200å¤©çºªå¿µæ—¥å¿«ä¹</title>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff9a9e;
            --secondary-color: #fad0c4;
            --text-color: #5d4037;
            --accent-color: #ff6b6b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Ma Shan Zheng', cursive;
            background: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
            background: linear-gradient(to top, #fad0c4 0%, #ffd1ff 100%);
            color: var(--text-color);
            height: 100vh;
            height: 100dvh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }

        section {
            width: 100%;
            height: 100vh;
            height: 100dvh;
            scroll-snap-align: start;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        /* --- ç¬¬ä¸€é¡µï¼šä¿¡å° --- */
        .envelope-wrapper {
            position: relative;
            cursor: pointer;
            animation: float 3s ease-in-out infinite;
            transform: scale(0.8);
        }

        .envelope {
            width: 300px;
            height: 200px;
            background: #f7f7f7;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-radius: 5px;
            display: flex;
            justify-content: center;
        }

        .lid {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 110px solid var(--primary-color);
            transform-origin: top;
            transition: transform 0.8s ease-in-out;
            z-index: 5;
        }

        .lid.open { transform: rotateX(180deg); z-index: 1; }

        .pocket {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-bottom: 190px solid #fff;
            z-index: 4;
        }

        .heart-seal {
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            color: #d32f2f;
            z-index: 6;
            transition: opacity 0.5s;
        }

        .letter {
            position: absolute;
            top: 10px;
            width: 260px;
            height: 380px;
            background: #fffdf9;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 1s ease-in-out, top 1s ease-in-out;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px dashed var(--primary-color);
            opacity: 0;
            font-size: 16px; 
        }

        .letter.show { transform: translateY(-150px); opacity: 1; z-index: 6; }

        .scroll-hint {
            position: absolute;
            bottom: 30px;
            font-size: 18px;
            animation: bounce 2s infinite;
            opacity: 0;
            transition: opacity 1s;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            pointer-events: none;
        }

        /* --- ç¬¬äºŒé¡µï¼šæŠ½å¥–æœº --- */
        .lottery-machine {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
            width: 90%;
            max-width: 400px;
            border: 2px solid #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-height: 80vh;
        }

        .prize-title {
            font-size: 26px;
            color: var(--accent-color);
            font-weight: bold;
            margin-bottom: 5px;
        }

        .prize-item {
            font-size: 18px;
            color: #666;
            margin-bottom: 15px;
        }

        .results-grid {
            display: grid;
            gap: 8px;
            width: 100%;
            margin-bottom: 20px;
            justify-content: center;
        }

        .grid-20 { grid-template-columns: repeat(5, 1fr); }
        .grid-10 { grid-template-columns: repeat(5, 1fr); }
        .grid-5  { grid-template-columns: repeat(5, 1fr); }
        .grid-1  { grid-template-columns: 1fr; }

        .lottery-ball {
            background: #f0f0f0;
            border-radius: 8px;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 14px;
            color: #333;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .grid-1 .lottery-ball {
            font-size: 60px;
            aspect-ratio: 2/1;
            height: 120px;
            margin: 0 auto; 
        }

        .lottery-btn {
            background: linear-gradient(to right, #ff9a9e 0%, #fecfef 100%);
            border: none;
            padding: 12px 40px;
            border-radius: 50px;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
            font-family: 'Ma Shan Zheng', cursive;
            width: 80%;
        }

        .lottery-btn:disabled { background: #ccc; box-shadow: none; }

        /* --- æœ€ç»ˆæƒŠå–œ --- */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.92); 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1.5s;
        }

        /* é¥±æ»¡çˆ±å¿ƒå®¹å™¨ */
        .heart-photo-container {
            width: 280px;
            height: 280px;
            clip-path: path('M 140, 60 C 90, 0 10, 40 10, 110 C 10, 180 90, 220 140, 260 C 190, 220 270, 180 270, 110 C 270, 40 190, 0 140, 60 Z');
            background-color: #ff6b6b;
            margin-bottom: 40px;
            animation: heartbeat 1.5s infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .heart-photo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
        }
        
        /* é—®é¢˜å’Œé€‰é¡¹åŒºåŸŸ */
        .question-container {
            text-align: center;
            color: #fff;
            opacity: 0; 
            transform: translateY(20px);
            transition: all 1s ease-out;
            width: 85%;
        }

        .question-text {
            font-size: 26px;
            margin-bottom: 30px;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
            line-height: 1.4;
        }

        .options-group {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .option-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 20px;
            font-family: 'Ma Shan Zheng', cursive;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            color: white;
            white-space: nowrap;
        }

        .btn-yes {
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            box-shadow: 0 4px 10px rgba(255, 154, 158, 0.5);
        }

        .btn-super-yes {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            box-shadow: 0 4px 10px rgba(255, 107, 107, 0.5);
            font-size: 22px; 
        }

        .option-btn:active {
            transform: scale(0.95);
            box-shadow: none;
        }

        /* æœ€ç»ˆç¥ç¦è¯­ */
        .final-message {
            position: absolute;
            top: 65%;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 32px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s 0.5s;
            text-shadow: 0 0 15px rgba(255, 107, 107, 0.8);
        }

        /* --- èŠ±æŸé›¨åŠ¨ç”» --- */
        .flower {
            position: fixed;
            top: -50px;
            font-size: 30px;
            z-index: 1000;
            animation: fall linear forwards;
            pointer-events: none;
        }

        @keyframes fall {
            to { transform: translateY(110vh) rotate(360deg); }
        }

        @keyframes float { 0%, 100% { transform: scale(0.8) translateY(0); } 50% { transform: scale(0.8) translateY(-15px); } }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
        @keyframes heartbeat { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <audio id="bgMusic" loop>
        <source src="bgm.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
    </audio>

    <section id="page1">
        <div class="envelope-wrapper" onclick="openEnvelope()">
            <div class="envelope">
                <div class="lid" id="lid"></div>
                <div class="pocket"></div>
                <div class="heart-seal" id="seal">â¤</div>
                <div class="letter" id="letter">
                    <h2 style="color: #ff6b6b; margin-bottom: 10px;">ç‰å°ç±³äº²å¯</h2>
                    <p style="line-height: 1.6; text-align: justify; font-size: 15px;">
                    200å¤©çºªå¿µæ—¥å¿«ä¹!<br>
                    ç»†æ•°è¿™ä¸¤ç™¾ä¸ªæ—¥å¤œï¼Œæ»¡å¿ƒçš†æ˜¯æ¬¢å–œã€‚ æ˜¯ç”Ÿç—…æ—¶æ‚‰å¿ƒå®ˆæŠ¤çš„æ¸©å­˜ï¼Œæ˜¯æ—…é€”ä¸­å¹¶è‚©çœ‹è¿‡çš„ä¸‡æ°´åƒå±±ï¼Œæ›´æ˜¯ä¹¦æ¡Œå‰å…±å‹‰å‰è¡Œçš„æœæœæš®æš®ã€‚<br>
                    æ›¾å¬é—»â€œåˆè§ä¹æƒŠæ¬¢ï¼Œä¹…å¤„äº¦æ€¦ç„¶â€ï¼Œå¦‚ä»Šæ–¹çŸ¥ï¼Œå–œæ¬¢ä½ çš„æ„Ÿè§‰ï¼Œä»æœªéšæµå¹´é€’å‡ï¼Œåè€Œæ„ˆå‘æ·±åˆ»ã€‚<br>
                    ä¸ºä½ å‡†å¤‡äº†ä¸€ä¸ªå°å½©è›‹ï¼Œç¥ä½ å¥½è¿~<br>
                    çˆ±ä½ çš„ï¼Œå°æœ±æœ±
                    </p>
                </div>
            </div>
        </div>
        <div class="scroll-hint" id="scrollHint">ğŸ‘‡ ä¸‹æ»‘å¼€å¯æŠ½å¥– ğŸ‘‡</div>
    </section>

    <section id="page2">
        <div class="lottery-machine">
            <div class="prize-title" id="prizeTitle">ä¸‰ç­‰å¥–æŠ½å¥–</div>
            <div class="prize-item" id="prizeItem">å¥–å“ï¼šçºªå¿µå†°ç®±è´´ (20äºº)</div>
            
            <div class="results-grid grid-20" id="resultsGrid">
                </div>

            <button class="lottery-btn" id="actionBtn" onclick="toggleLottery()">å¼€å§‹æŠ½å¥–</button>
        </div>
    </section>

    <div class="overlay" id="finalOverlay">
        <div class="heart-photo-container">
            <img src="picture.jpg" alt="Love Photo" id="finalPhoto">
        </div>

        <div class="question-container" id="questionBox">
            <div class="question-text">æ„¿æ„å’Œæˆ‘ä¸€èµ·å¼€å¯<br>æ‹çˆ±æ–°ç¯‡ç« å—ï¼Ÿ</div>
            <div class="options-group">
                <button class="option-btn btn-yes" onclick="handleFinalChoice()">æˆ‘æ„¿æ„ï¼</button>
                <button class="option-btn btn-super-yes" onclick="handleFinalChoice()">æˆ‘è¶…æ„¿æ„ï¼</button>
            </div>
        </div>

        <div class="final-message" id="finalMessage">çˆ±ä½ ä¸æ­¢200å¤©ï¼Œæœªæ¥æ¯ä¸€æ­¥éƒ½æœ‰ä½  â¤</div>
    </div>

    <script>
        // é…ç½®
        const prizes = [
            { id: 0, title: "ä¸‰ç­‰å¥–", item: "çºªå¿µå†°ç®±è´´ (20äºº)", count: 20, class: "grid-20", hasTarget: false },
            { id: 1, title: "äºŒç­‰å¥–", item: "MLB å¸½å­ (10äºº)", count: 10, class: "grid-10", hasTarget: true },
            { id: 2, title: "ä¸€ç­‰å¥–", item: "é•¿æ¬¾é´å­ (5äºº)", count: 5, class: "grid-5", hasTarget: true },
            { id: 3, title: "ç‰¹ç­‰å¥–", item: "ç¥ç§˜å¥–å“ï¼Ÿï¼Ÿï¼Ÿ", count: 1, class: "grid-1", hasTarget: true }
        ];

        let step = 0;
        let isRolling = false;
        let rollInterval = null;

        window.onload = () => { 
            document.getElementById('prizeTitle').innerText = prizes[0].title;
            document.getElementById('prizeItem').innerText = "å¥–å“ï¼š" + prizes[0].item;
            initGrid(prizes[0]); 
        };

        // --- ä¿¡å°å’ŒæŠ½å¥–é€»è¾‘ ---
        function openEnvelope() {
            // ç‚¹å‡»ä¿¡å°æ—¶æ’­æ”¾éŸ³ä¹ï¼ˆè§£å†³è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼‰
            const bgMusic = document.getElementById('bgMusic');
            bgMusic.play().catch(error => {
                console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œå¯èƒ½æ˜¯äº¤äº’é™åˆ¶:", error);
            });

            document.getElementById('lid').classList.add('open');
            document.getElementById('seal').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('letter').classList.add('show');
                setTimeout(() => {
                    document.getElementById('scrollHint').style.opacity = '1';
                }, 1500);
            }, 800);
        }

        function initGrid(prizeConfig) {
            const grid = document.getElementById('resultsGrid');
            grid.className = `results-grid ${prizeConfig.class}`;
            grid.innerHTML = '';
            for (let i = 0; i < prizeConfig.count; i++) {
                const ball = document.createElement('div');
                ball.className = 'lottery-ball';
                ball.innerText = '000';
                grid.appendChild(ball);
            }
        }

        function toggleLottery() {
            const btn = document.getElementById('actionBtn');
            const balls = document.querySelectorAll('.lottery-ball');

            if (!isRolling) {
                isRolling = true;
                btn.innerText = "åœæ­¢";
                rollInterval = setInterval(() => {
                    balls.forEach(ball => {
                        ball.innerText = Math.floor(Math.random() * 1001).toString().padStart(3, '0');
                    });
                }, 50);

            } else {
                isRolling = false;
                btn.disabled = true;

                if (step === 3) {
                    clearInterval(rollInterval);
                    let slowDownDelays = [100, 200, 350, 600, 1000]; 
                    let delayIndex = 0;
                    function slowRoll() {
                        if (delayIndex < slowDownDelays.length) {
                            balls[0].innerText = Math.floor(Math.random() * 1001).toString().padStart(3, '0');
                            setTimeout(slowRoll, slowDownDelays[delayIndex]);
                            delayIndex++;
                        } else {
                            balls[0].innerText = '999';
                            setTimeout(triggerFinalePreparation, 1500);
                        }
                    }
                    slowRoll(); 
                    return;
                }

                clearInterval(rollInterval);
                const currentPrize = prizes[step];
                const finalNumbers = generateNumbers(currentPrize.count, currentPrize.hasTarget);
                balls.forEach((ball, index) => {
                    ball.innerText = finalNumbers[index].toString().padStart(3, '0');
                });
                btn.innerText = "ä¸‹ä¸€è½®";
                btn.onclick = prepareNextRound;
                btn.disabled = false;
            }
        }

        function prepareNextRound() {
            step++;
            if (step < prizes.length) {
                const nextPrize = prizes[step];
                const btn = document.getElementById('actionBtn');
                document.getElementById('prizeTitle').innerText = nextPrize.title;
                document.getElementById('prizeItem').innerText = "å¥–å“ï¼š" + nextPrize.item;
                initGrid(nextPrize);
                btn.innerText = "å¼€å§‹æŠ½å¥–";
                btn.onclick = toggleLottery;
                btn.disabled = false;
            }
        }

        function generateNumbers(count, includeTarget) {
            let results = [];
            if (includeTarget) results.push(999);
            while (results.length < count) {
                let r = Math.floor(Math.random() * 1001);
                if (r !== 999 && !results.includes(r)) results.push(r);
            }
            if (count > 1) {
                 for (let i = results.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [results[i], results[j]] = [results[j], results[i]];
                }
            }
            return results;
        }

        // --- æœ€ç»ˆç¯èŠ‚é€»è¾‘ ---
        function triggerFinalePreparation() {
            const overlay = document.getElementById('finalOverlay');
            overlay.style.opacity = '1';
            overlay.style.pointerEvents = 'all';
            
            setTimeout(() => {
                const questionBox = document.getElementById('questionBox');
                questionBox.style.opacity = '1';
                questionBox.style.transform = 'translateY(0)';
            }, 1200);
        }

        function handleFinalChoice() {
            const questionBox = document.getElementById('questionBox');
            questionBox.style.opacity = '0';
            questionBox.style.transform = 'translateY(-20px)';
            questionBox.style.pointerEvents = 'none';

            document.getElementById('finalMessage').style.opacity = '1';
            startFlowerRain();
        }

        function startFlowerRain() {
            const flowers = ['ğŸ’', 'ğŸŒ¸', 'ğŸ’®', 'ğŸŒ¹', 'ğŸŒº', 'ğŸŒ»'];
            const container = document.getElementById('finalOverlay');
            
            const rainInterval = setInterval(() => {
                const flower = document.createElement('div');
                flower.className = 'flower';
                flower.innerText = flowers[Math.floor(Math.random() * flowers.length)];
                
                flower.style.left = Math.random() * 100 + 'vw';
                flower.style.fontSize = (Math.random() * 20 + 20) + 'px';
                flower.style.animationDuration = (Math.random() * 3 + 2) + 's'; 

                container.appendChild(flower);

                setTimeout(() => {
                    flower.remove();
                }, 5000);

            }, 300); 
        }
    </script>
</body>
</html>